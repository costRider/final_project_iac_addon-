name: Destroy EKS Addons

on:
  workflow_dispatch:   # ğŸ‘ˆ í•„ìš”í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰

jobs:
  destroy-addons:
    runs-on: [self-hosted, mgmt]   # ğŸ‘ˆ ìš°ë¦¬ê°€ ë“±ë¡í•´ ë‘” mgmt EC2 runner ë¼ë²¨

    defaults:
      run:
        working-directory: ./envs/dev   # ğŸ‘ˆ ì´ ë ˆí¬ì—ì„œ terraform ì‹¤í–‰í•˜ëŠ” ë””ë ‰í† ë¦¬ë¡œ ë§ì¶°ì¤˜

    steps:
      - name: Checkout addon repo
        uses: actions/checkout@v4

      - name: Set up Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: "1.14.0"

      # (ì„ íƒ) fmt/validate ê°™ì€ ê±´ destroyì—ëŠ” êµ³ì´ í•„ìš” ì—†ìœ¼ë‹ˆ ìƒëµí•´ë„ ë¨

      - name: Terraform Init
        run: |
          terraform init \
            -input=false

      - name: Terraform Destroy
        run: |
          terraform destroy -auto-approve -input=false
